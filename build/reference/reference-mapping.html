
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>3. Reference Mapping &mdash; Doctrine MongoDB ODM v1.0.0-BETA2 documentation</title>
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/configurationblock.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0.0-BETA2',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/configurationblock.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/configurationblock.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/configurationblock.js"></script>
    <link rel="top" title="Doctrine MongoDB ODM v1.0.0-BETA2 documentation" href="../index.html" />
    <link rel="next" title="4. Embedded Mapping" href="embedded-mapping.html" />
    <link rel="prev" title="2. Basic Mapping" href="basic-mapping.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="embedded-mapping.html" title="4. Embedded Mapping"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="basic-mapping.html" title="2. Basic Mapping"
             accesskey="P">previous</a> |</li>
        <li><a href="http://www.doctrine-project.org">Doctrine Homepage</a> &raquo;</li>
        <li><a href="../index.html">Doctrine MongoDB ODM v1.0.0-BETA2 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="reference-mapping">
<h1>3. Reference Mapping<a class="headerlink" href="#reference-mapping" title="Permalink to this headline">¶</a></h1>
<p>This chapter explains how references between documents are mapped
with Doctrine.</p>
<div class="section" id="collections">
<h2>3.1. Collections<a class="headerlink" href="#collections" title="Permalink to this headline">¶</a></h2>
<p>In all the examples of many-valued references in this manual we
will make use of a <tt class="docutils literal"><span class="pre">Collection</span></tt> interface and a corresponding
default implementation <tt class="docutils literal"><span class="pre">ArrayCollection</span></tt> that are defined in the
<tt class="docutils literal"><span class="pre">Doctrine\Common\Collections</span></tt> namespace. Why do we need that?
Doesn&#8217;t that couple my domain model to Doctrine? Unfortunately, PHP
arrays, while being great for many things, do not make up for good
collections of business objects, especially not in the context of
an ODM. The reason is that plain PHP arrays can not be
transparently extended / instrumented in PHP code, which is
necessary for a lot of advanced ODM features. The classes /
interfaces that come closest to an OO collection are ArrayAccess
and ArrayObject but until instances of these types can be used in
all places where a plain array can be used (something that may
happen in PHP6) their usability is fairly limited. You &#8220;can&#8221;
type-hint on <tt class="docutils literal"><span class="pre">ArrayAccess</span></tt> instead of <tt class="docutils literal"><span class="pre">Collection</span></tt>, since the
Collection interface extends <tt class="docutils literal"><span class="pre">ArrayAccess</span></tt>, but this will
severely limit you in the way you can work with the collection,
because the <tt class="docutils literal"><span class="pre">ArrayAccess</span></tt> API is (intentionally) very primitive
and more importantly because you can not pass this collection to
all the useful PHP array functions, which makes it very hard to
work with.</p>
<p><strong>CAUTION</strong> The Collection interface and ArrayCollection class,
like everything else in the Doctrine namespace, are neither part of
the ODM, it is a plain PHP class that has no outside dependencies
apart from dependencies on PHP itself (and the SPL). Therefore
using this class in your domain classes and elsewhere does not
introduce a coupling to the persistence layer. The Collection
class, like everything else in the Common namespace, is not part of
the persistence layer. You could even copy that class over to your
project if you want to remove Doctrine from your project and all
your domain classes will work the same as before.</p>
</div>
<div class="section" id="reference-one">
<h2>3.2. Reference One<a class="headerlink" href="#reference-one" title="Permalink to this headline">¶</a></h2>
<p>Reference one document:</p>
<div class="configuration-block">
<ul class="simple">
<li><em>PHP</em><div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">Documents</span><span class="p">;</span>

<span class="sd">/** @Document */</span>
<span class="k">class</span> <span class="nc">Product</span>
<span class="p">{</span>
    <span class="c1">// ...</span>

    <span class="sd">/**</span>
<span class="sd">     * @ReferenceOne(targetDocument=&quot;Shipping&quot;)</span>
<span class="sd">     */</span>
    <span class="k">private</span> <span class="nv">$shipping</span><span class="p">;</span>

    <span class="c1">// ...</span>
<span class="p">}</span>

<span class="sd">/** @Document */</span>
<span class="k">class</span> <span class="nc">Shipping</span>
<span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><em>XML</em><div class="highlight-xml"><div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;doctrine-mongo-mapping</span> <span class="na">xmlns=</span><span class="s">&quot;http://doctrine-project.org/schemas/odm/doctrine-mongo-mapping&quot;</span>
                <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
                <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://doctrine-project.org/schemas/odm/doctrine-mongo-mapping</span>
<span class="s">                http://doctrine-project.org/schemas/odm/doctrine-mongo-mapping.xsd&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;document</span> <span class="na">name=</span><span class="s">&quot;Documents\Product&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;reference-one</span> <span class="na">fieldName=</span><span class="s">&quot;shipping&quot;</span> <span class="na">targetDocument=</span><span class="s">&quot;Documents\Shipping&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/document&gt;</span>
<span class="nt">&lt;/doctrine-mongo-mapping&gt;</span>
</pre></div>
</div>
</li>
<li><em>YAML</em><div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">User</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">document</span>
  <span class="l-Scalar-Plain">referenceOne</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">shipping</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">targetDocument</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Documents\Shipping</span>
</pre></div>
</div>
</li>
</ul>
</div>
</div>
<div class="section" id="reference-many">
<h2>3.3. Reference Many<a class="headerlink" href="#reference-many" title="Permalink to this headline">¶</a></h2>
<p>Reference many documents:</p>
<div class="configuration-block">
<ul class="simple">
<li><em>PHP</em><div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">Documents</span><span class="p">;</span>

<span class="sd">/** @Document */</span>
<span class="k">class</span> <span class="nc">User</span>
<span class="p">{</span>
    <span class="c1">// ...</span>

    <span class="sd">/**</span>
<span class="sd">     * @ReferenceMany(targetDocument=&quot;Account&quot;)</span>
<span class="sd">     */</span>
    <span class="k">private</span> <span class="nv">$accounts</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>

    <span class="c1">// ...</span>
<span class="p">}</span>

<span class="sd">/** @Document */</span>
<span class="k">class</span> <span class="nc">Account</span>
<span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><em>XML</em><div class="highlight-xml"><div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;doctrine-mongo-mapping</span> <span class="na">xmlns=</span><span class="s">&quot;http://doctrine-project.org/schemas/odm/doctrine-mongo-mapping&quot;</span>
                <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
                <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://doctrine-project.org/schemas/odm/doctrine-mongo-mapping</span>
<span class="s">                http://doctrine-project.org/schemas/odm/doctrine-mongo-mapping.xsd&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;document</span> <span class="na">name=</span><span class="s">&quot;Documents\Product&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;reference-many</span> <span class="na">fieldName=</span><span class="s">&quot;accounts&quot;</span> <span class="na">targetDocument=</span><span class="s">&quot;Documents\Account&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/document&gt;</span>
<span class="nt">&lt;/doctrine-mongo-mapping&gt;</span>
</pre></div>
</div>
</li>
<li><em>YAML</em><div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">User</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">document</span>
  <span class="l-Scalar-Plain">referenceMany</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">accounts</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">targetDocument</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Documents\Account</span>
</pre></div>
</div>
</li>
</ul>
</div>
</div>
<div class="section" id="mixing-document-types">
<h2>3.4. Mixing Document Types<a class="headerlink" href="#mixing-document-types" title="Permalink to this headline">¶</a></h2>
<p>If you want to store different types of documents in references you
can simply omit the <tt class="docutils literal"><span class="pre">targetDocument</span></tt> option:</p>
<div class="configuration-block">
<ul class="simple">
<li><em>PHP</em><div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="sd">/** @Document */</span>
<span class="k">class</span> <span class="nc">User</span>
<span class="p">{</span>
    <span class="c1">// ..</span>

    <span class="sd">/** @ReferenceMany */</span>
    <span class="k">private</span> <span class="nv">$favorites</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>

    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><em>XML</em><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;field</span> <span class="na">fieldName=</span><span class="s">&quot;favorites&quot;</span> <span class="nt">/&gt;</span>
</pre></div>
</div>
</li>
<li><em>YAML</em><div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">referenceMany</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">favorites</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">~</span>
</pre></div>
</div>
</li>
</ul>
</div>
<p>Now the <tt class="docutils literal"><span class="pre">$favorites</span></tt> property can store a reference to any type
of document! The class name will be automatically added for you in
a field named <tt class="docutils literal"><span class="pre">_doctrine_class_name</span></tt>.</p>
<p>You can also specify a discriminator map to avoid storing the fully
qualified class name with each reference:</p>
<div class="configuration-block">
<ul class="simple">
<li><em>PHP</em><div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">Documents</span><span class="p">;</span>

<span class="sd">/** @Document */</span>
<span class="k">class</span> <span class="nc">User</span>
<span class="p">{</span>
    <span class="c1">// ..</span>

    <span class="sd">/**</span>
<span class="sd">     * @ReferenceMany(</span>
<span class="sd">     *   discriminatorMap={</span>
<span class="sd">     *     &quot;album&quot;=&quot;Album&quot;,</span>
<span class="sd">     *     &quot;song&quot;=&quot;Song&quot;</span>
<span class="sd">     *   }</span>
<span class="sd">     * )</span>
<span class="sd">     */</span>
    <span class="k">private</span> <span class="nv">$favorites</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>

    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><em>XML</em><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;reference-many</span> <span class="na">fieldName=</span><span class="s">&quot;favorites&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;discriminator-map&gt;</span>
        <span class="nt">&lt;discriminator-mapping</span> <span class="na">value=</span><span class="s">&quot;album&quot;</span> <span class="na">class=</span><span class="s">&quot;Documents\Album&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;discriminator-mapping</span> <span class="na">value=</span><span class="s">&quot;song&quot;</span> <span class="na">class=</span><span class="s">&quot;Documents\Song&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/discriminator-map&gt;</span>
<span class="nt">&lt;/reference-many&gt;</span>
</pre></div>
</div>
</li>
<li><em>YAML</em><div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">referenceMany</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">favorites</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">discriminatorMap</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">album</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Documents\Album</span>
      <span class="l-Scalar-Plain">song</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Documents\Song</span>
</pre></div>
</div>
</li>
</ul>
</div>
<p>If you want to store the discriminator value in a field other than
<tt class="docutils literal"><span class="pre">_doctrine_class_name</span></tt> you can use the <tt class="docutils literal"><span class="pre">discriminatorField</span></tt>
option:</p>
<div class="configuration-block">
<ul class="simple">
<li><em>PHP</em><div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="sd">/** @Document */</span>
<span class="k">class</span> <span class="nc">User</span>
<span class="p">{</span>
    <span class="c1">// ..</span>

    <span class="sd">/**</span>
<span class="sd">     * @ReferenceMany(discriminatorField=&quot;type&quot;)</span>
<span class="sd">     */</span>
    <span class="k">private</span> <span class="nv">$favorites</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>

    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><em>XML</em><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;reference-many</span> <span class="na">fieldName=</span><span class="s">&quot;favorites&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;discriminator-field</span> <span class="na">name=</span><span class="s">&quot;type&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/reference-many&gt;</span>
</pre></div>
</div>
</li>
<li><em>YAML</em><div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">referenceMany</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">favorites</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">discriminatorField</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">type</span>
</pre></div>
</div>
</li>
</ul>
</div>
</div>
<div class="section" id="cascading-operations">
<h2>3.5. Cascading Operations<a class="headerlink" href="#cascading-operations" title="Permalink to this headline">¶</a></h2>
<p>By default Doctrine will not cascade any <tt class="docutils literal"><span class="pre">UnitOfWork</span></tt> operations
to referenced documents so if wish to have this functionality you
must explicitly enable it:</p>
<div class="configuration-block">
<ul class="simple">
<li><em>PHP</em><div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="sd">/**</span>
<span class="sd"> * @ReferenceOne(targetDocument=&quot;Profile&quot;, cascade={&quot;persist&quot;})</span>
<span class="sd"> */</span>
<span class="k">private</span> <span class="nv">$profile</span><span class="p">;</span>
</pre></div>
</div>
</li>
<li><em>XML</em><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;reference-one</span> <span class="na">target-document=</span><span class="s">&quot;Documents\Profile&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;cascade&gt;</span>
        <span class="nt">&lt;cascade-persist/&gt;</span>
    <span class="nt">&lt;/cascade&gt;</span>
<span class="nt">&lt;/reference-one&gt;</span>
</pre></div>
</div>
</li>
<li><em>YAML</em><div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">referenceOne</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">profile</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">cascade</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="nv">persist</span><span class="p-Indicator">]</span>
</pre></div>
</div>
</li>
</ul>
</div>
<p>The valid values are:</p>
<ul class="simple">
<li><strong>all</strong> - cascade on all operations by default.</li>
<li><strong>detach</strong> - cascade detach operation to referenced documents.</li>
<li><strong>merge</strong> - cascade merge operation to referenced documents.</li>
<li><strong>refresh</strong> - cascade refresh operation to referenced documents.</li>
<li><strong>remove</strong> - cascade remove operation to referenced documents.</li>
<li><strong>persist</strong> - cascade persist operation to referenced documents.</li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <h3><a href="../index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference internal" href="#">3. Reference Mapping</a><ul>
<li><a class="reference internal" href="#collections">3.1. Collections</a></li>
<li><a class="reference internal" href="#reference-one">3.2. Reference One</a></li>
<li><a class="reference internal" href="#reference-many">3.3. Reference Many</a></li>
<li><a class="reference internal" href="#mixing-document-types">3.4. Mixing Document Types</a></li>
<li><a class="reference internal" href="#cascading-operations">3.5. Cascading Operations</a></li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="basic-mapping.html"
                                  title="previous chapter">2. Basic Mapping</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="embedded-mapping.html"
                                  title="next chapter">4. Embedded Mapping</a></p>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="../_sources/reference/reference-mapping.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="../search.html" method="get">
                <input type="text" name="q" size="18" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="embedded-mapping.html" title="4. Embedded Mapping"
             >next</a> |</li>
        <li class="right" >
          <a href="basic-mapping.html" title="2. Basic Mapping"
             >previous</a> |</li>
        <li><a href="http://www.doctrine-project.org">Doctrine Homepage</a> &raquo;</li>
        <li><a href="../index.html">Doctrine MongoDB ODM v1.0.0-BETA2 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
      &copy; Copyright 2010, Doctrine Project Team.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.7.
    </div>
  </body>
</html>