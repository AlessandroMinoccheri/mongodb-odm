> **SIDEBAR**
> From MongoDB.org:
>
> MongoDB supports a "find, modify, and return" command. This command can be used to
> atomically modify a document (at most one) and return it. Note that, by default, the
> document returned will not include the modifications made on the update.

Doctrine fully integrates the find and modify functionality to the query object so you can
easily run these types of queries!

## Update

For example you can update a job and return it:

    <?php
    $job = $dm->createQuery('Job')
        // Find the job
        ->findAndModify()
        ->field('in_progress')->set(true)
        ->field('in_progress')->equals(false)
        ->sort('priority', 'desc')

        // Update found job
        ->update()
        ->field('started')->set(new \MongoDate())
        ->execute();

If you want to update a job and return the new document you can pass some options to the
`findAndModify()` method. It accepts an array of options and the allowed keys are:

 * **new** - Set to true if you want to return the modified object rather than the original. Ignored for remove.
 * **upsert** - Create object if it doesn't exist.

-

Here is an example where we return the new updated job document:

    <?php
    $job = $dm->createQuery('Job')
        // Find the job
        ->findAndModify(array('new' => true))
        ->field('in_progress')->equals(false)
        ->sort('priority', 'desc')

        // Update found job
        ->update()
        ->field('started')->set(new \MongoDate())
        ->field('in_progress')->set(true)
        ->execute();

The returned `$job` will be a managed `Job` instance with the `started` and `in_progress`
fields updated.

## Remove

You can also remove a document and return it:

    <?php
    $job = $dm->createQuery('Job')
        // Find the job
        ->findAndModify()
        ->sort('priority', 'desc')

        // Remove found job
        ->remove()
        ->execute();

You can read more about the find and modify functionality on the [MongoDB website](http://www.mongodb.org/display/DOCS/findandmodify+Command).